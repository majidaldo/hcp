{%set project_name=  os.path.basename(os.path.abspath(os.path.join(root, '..')))  %}
# don't install stuff from this env
{% set keep_here =     not is_included %}  # https://github.com/ESSS/conda-devenv/issues/120
{% set dev_req =       keep_here %}
{% set wrapped_exe =   keep_here %}
{% set run_req =       True %}  # just annotation

{% set included_workdirs = ['project', ] %}

dependencies:
    - invoke            # [keep_here]
    - python=3.7        # [keep_here] TODO p38 problem on windows asyncio NotImplementedError
    - jupyter           # [wrapped_exe]
    - jupytext          # [wrapped_exe]
    #- nbpresent not installing creating conflicts # [not is_included]
    - papermill         # [wrapped_exe]
    #- fastai::nbdev     # [run_req] interesting but not great
    - pip               # [not is_included]
    - pip:
        - jupyter-book  # [wrapped_exe]
        - magicinvoke   # [dev_req]
environment:
  # probably want to append PATH and PYTHONPATH in your env
  PATH:
    - '{{root}}'
  PYTHONPATH:
    - '{{root}}'
  JUPYTER_CONFIG_DIR: '{{root}}'
  #                              don't define the following in envs that include this
  WORK_DIR: '{{  os.path.basename(root) }}'                       # [keep_here]
  WORKDIR:  '{{  os.path.basename(root) }}'                       # [keep_here]
  WORK_DIR_PATH: '{{root}}'                                       # [keep_here]
  WORKDIR_PATH:  '{{root}}'                                       # [keep_here]
  PROJECTROOT:  '{{ os.path.abspath(os.path.join(root, '..')) }}' # [keep_here]
  PROJECT_ROOT: '{{ os.path.abspath(os.path.join(root, '..')) }}' # [keep_here]
  PROJECT_NAME: '{{project_name}}'                                # [keep_here]
includes:
{% for included in included_workdirs %}
  - '{{root}}/../{{included}}/environment.devenv.yml'
{% endfor %}
name: {{project_name}}-{{os.path.basename(root)}}
